
// src/components/onedrive.js
// Gemensam OneDrive-picker (små bokstäver i filnamn, NAMN-export pickOneDriveFiles)

export function pickOneDriveFiles({ clientId, onSuccess, onError }) {
  if (typeof window === "undefined" || !window.OneDrive) {
    const err = new Error("OneDrive SDK ej laddad. Kontrollera index.html-skriptet.");
    console.error(err);
    onError?.(err);
    alert("OneDrive SDK ej laddad. Kontrollera index.html.");
    return;
  }
  if (!clientId) {
    const err = new Error("Saknar Application (client) ID för OneDrive.");
    console.error(err);
    onError?.(err);
    alert("Saknar Application (client) ID för OneDrive.");
    return;
  }

  const opts = {
    clientId,
    action: "share",
    multiSelect: true,
    openInNewWindow: true,
    advanced: { redirectUri: window.location.origin },
    success: (files) => {
      const normalized = (files?.value || []).map((f) => ({
        id: f.id,
        name: f.name,
        link: f.links?.sharingLink?.webUrl || f.webUrl,
        webUrl: f.webUrl,
        size: f.size,
        isFolder: !!f.folder
      }));
      onSuccess?.(normalized);
    },
    cancel: () => {},
    error: (e) => {
      console.error("OneDrive Picker error", e);
      onError?.(e);
      alert("Kunde inte hämta från OneDrive. Kontrollera behörigheter eller försök igen.");
    }
  };

  window.OneDrive.open(opts);
}

